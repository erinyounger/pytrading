# PyTrading 项目开发原则

## 核心架构
- **前后端分离**: FastAPI + React 18 + TypeScript
- **数据库优先**: 所有计算在数据库层面完成，前端仅展示
- **模块化设计**: 清晰的代码组织结构

## 技术栈约束
- **后端**: Python 3.9+ + FastAPI + SQLAlchemy 2.0+ + MySQL
- **前端**: React 18 + TypeScript + Ant Design
- **部署**: 后端 8000 端口，前端 3000 端口

## 开发规范

### 后端规范
- RESTful API + Pydantic 数据验证
- SQLAlchemy ORM，避免原生 SQL
- 统一异常处理和结构化日志

### 前端规范
- React 函数组件 + Hooks
- TypeScript 类型安全
- Ant Design 组件库一致性

### 数据库规范
- 第三范式设计，避免冗余
- 适当索引优化查询性能
- SQL 脚本管理数据库变更

## 功能开发原则

### 回测结果管理
- 数据库层面筛选、分页、聚合
- 同一股票只保留最新记录
- 前端仅处理展示和交互

### 策略管理
- 所有策略继承 StrategyBase
- 支持参数动态配置
- 回测并行，实盘单线程

### 实时监控
- 实时数据更新
- 性能监控和异常处理

### 数据库兼容性
- **向后兼容**: 保留所有现有字段和API
- **渐进式升级**: 新增功能不影响现有功能
- **数据完整性**: 通过外键约束保证数据一致性
- **性能优化**: 合理索引设计提升查询效率

## 性能与安全
- **数据库优化**: 索引 + 分页查询 + 连接池
- **前端优化**: 懒加载 + 缓存策略
- **安全防护**: 输入验证 + 权限控制 + 日志审计

## 扩展性设计
- **策略扩展**: 插件化 + 参数化 + 版本管理
- **功能扩展**: 模块化 + 标准化接口
- **配置化**: 支持功能开关

## 质量保证
- **代码质量**: PEP 8 + ESLint 规范
- **测试覆盖**: 核心逻辑 > 80%
- **版本管理**: 语义化版本 + 变更日志

## 数据库架构设计

### 核心表结构
- **strategies**: 策略表（策略代码、显示名称、参数配置）
- **symbols**: 股票池表（股票代码、名称、行业分类）
- **backtest_tasks**: 回测任务表（任务状态、进度、参数）
- **backtest_results**: 回测结果表（兼容现有结构，扩展新字段）
- **system_config**: 系统配置表（交易模式、并发数等）

### 设计原则
- **简化设计**: 避免过度设计，专注核心功能
- **兼容现有**: 保持现有代码结构，最小化改动
- **数据库优先**: 所有计算在数据库层面完成
- **渐进式升级**: 支持新功能，保持向后兼容

### 兼容性规则
- **字段兼容**: 保留所有现有字段，新增扩展字段
- **API兼容**: 现有API接口保持不变
- **视图兼容**: 查询视图包含所有原有字段
- **外键约束**: 可选外键约束，避免数据不一致问题

## TODO List - 待开发功能

### 已完成功能 ✅
- [x] 回测结果展示（数据库筛选、分页、搜索）
- [x] 回测结果表格优化（时间拆分、当前股价、去重）
- [x] 仪表板KPI展示（策略盈利能力、关注标的）
- [x] 趋势筛选功能（表头筛选、下拉筛选）
- [x] 前后端分离架构（FastAPI + React）
- [x] 数据库优先设计（所有计算在数据库层面）
- [x] 回测管理页面合并（策略管理+实时监控）
- [x] 数据库架构设计（兼容现有结构）

### 回测管理模块重构 🔄
- [x] 数据库架构设计（兼容现有结构）
- [ ] 更新SQLAlchemy模型适配新表结构
- [ ] 更新API接口适配新数据结构
- [ ] 更新前端代码适配新数据模型
- [ ] 回测任务管理（创建、状态跟踪、进度监控）
- [ ] 策略管理（列表、详情、参数配置）
- [ ] 股票池管理（股票列表、分类筛选）

### 系统设置模块
- [ ] 交易模式配置（回测/实盘切换）
- [ ] 数据库配置（连接参数、备份设置）
- [ ] API配置（掘金API、第三方数据源）

### 性能优化
- [ ] 数据库查询优化（索引优化、查询缓存）
- [ ] 前端性能优化（懒加载、虚拟滚动）
- [ ] 缓存策略（Redis缓存、本地缓存）

---

**核心原则**: 数据库优先、模块化设计、类型安全、性能优化、安全防护、向后兼容
